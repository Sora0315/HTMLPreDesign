<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!-- X-UA-Compatible設置IE兼容模式 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <!--RWD-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0" />
    <meta name="author" content="萊茵巴赫科技" />
    <meta name="copyright" content="萊茵巴赫科技" />
    <!-- 結構化資料 SEO 與 meta 標籤 -->
    <meta property="og:title" content="柚美。柚好" />
    <meta property="og:url" content="">
    <meta property="og:image" content="要顯示的縮圖網址" />
    <meta property="og:description" content="網頁描述" />
    <link rel="stylesheet" href="css/normalize.css" />
    <link rel="stylesheet" href="css/style.css" />
    <title>柚美。柚好</title>
    <script src="js/jquery-3.2.1.js"></script>
    <script src="js/semantic.js"></script>
    <script src="js/jquery.twzipcode.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
    <script src="js/reinbachCommon.js"></script>
</head>

<body style="background: none">
    <!--共用樣式區，sidebar-->
    <div id="memberSidebar" class="ui left vertical inverted sidebar menu">
        <div class="header">美好會員中心</div>
        <div class="sidebar-logo">
            <img src="images/member-sidebar-logo.png" class="img-fluid" alt="" />
        </div>
        <div class="section-header">會員資料管理</div>
        <div class="profile-manage">
            <a class="item nav-link" href="memberProfile.html">個人資料修改</a>
            <a class="item nav-link" href="memberResetPwd.html">密碼修改</a>
        </div>
        <div class="section-header">會員訂單管理</div>
        <div class="order-manage">
            <a class="item nav-link" href="memberMyOrder.html">我的訂單</a>
            <a class="item nav-link" href="memberOrderReturnIndex.html">退貨申請</a>
            <a class="item nav-link" href="memberOrderCancel.html">取消訂單</a>
        </div>
        <div class="section-header">紅利與購物金</div>
        <div class="bonus-funds-manage">
            <a class="item nav-link" href="memberBonus.html">紅利回饋</a>
            <a class="item nav-link" href="memberFunds.html">購物金</a>
        </div>
        <div class="section-header">購物小幫手</div>
        <div class="order-help">
            <a class="item nav-link" href="memberHelper1.html">紅利回饋與購物金說明</a>
            <a class="item nav-link" href="memberHelper2.html">購物流程</a>
            <a class="item nav-link" href="memberHelper3.html">服務條款與隱私政策</a>
        </div>
    </div>
    <script>
        $('#memberSidebar .item').hover(
            function() {
                $(this).children('.img-fluid').css('opacity', '1');
            },
            function() {
                $(this).children('.img-fluid').css('opacity', '0');
            }
        );
    </script>

    <div class="pusher">
        <!--共用樣式區，Header-->
        <header>
            <nav class="nav member-common-menu">
                <img src="images/order-bounce-logo1.png" class="img-fluid bounce-logo" alt="" />
                <div class="hamburger">&#9776;</div>
                <a href="index.html" class="order-check-site-logo">
                    <img src="images/webLogo-order-check.png" class="img-fluid" alt="" />
                </a>
                <img src="images/order-bounce-logo2.png" class="img-fluid bounce-logo" alt="" />
            </nav>
        </header>
        <script>
            $('.member-common-menu .hamburger').click(
                function() {
                    $('#memberSidebar').sidebar('toggle');
                }
            );
            $('.member-common-menu .order-check-site-logo').hover(
                function() {
                    $(this).parent('.member-common-menu').children('.bounce-logo').toggleClass('rotate360');
                },
                function() {
                    $(this).parent('.member-common-menu').children('.bounce-logo').toggleClass('rotate360');
                }
            );
        </script>



        <div class="container profile-content">
            <script>
                var member = [{
                    'MemberID': 'M0000000009',
                    'Name': '松島聰',
                    'Cell': '0958990133',
                    'Mail': 'matsushima@gmail.com',
                    'Addr': '104臺北市中山區-長安東路二段155號2F',
                    'Birthday': '1990-02-27',
                    'ImgUrl': '',
                    'Bonus': 180,
                    'Funds': 2500
                }];
            </script>
            <div class="member-id"></div>
            <div class="left">
                <img src="images/mem-default.png" class="img-fluid" alt="" />
                <div class="member-head">
                    <img src="images/member-change-head.png" class="img-fluid" alt="" />
                    <div class="title">更換美好頭貼</div>
                </div>
            </div>
            <div class="right">
                <div class="member-account">會員帳號：
                    <span></span>
                    <div class="sub-title">(為註冊使用的Email)</div>
                </div>
                <div class="member-name">
                    <label>姓名</label>
                    <input class="" type="text" placeholder="請輸入姓名" />
                </div>
                <div class="member-birthday">
                    <label>生日</label>
                    <span>西元</span>
                    <input class="year" type="text" placeholder="年分" />
                    <span>年</span>
                    <div class="ui selection dropdown month" style="width: 5%;">
                        <input type="hidden" name="month">
                        <i class="dropdown icon"></i>
                        <div class="default text"></div>
                    </div>
                    <span>月</span>
                    <div class="ui selection dropdown day">
                        <input type="hidden" name="day">
                        <i class="dropdown icon"></i>
                        <div class="default text"></div>
                    </div>
                    <span>日</span>
                </div>
                <div class="member-cell">
                    <label>連絡電話</label>
                    <input class="" type="text" placeholder="請輸入聯絡電話" />
                </div>
                <div class="member-addr">
                    <label>地址</label>
                    <div class="twzipcode">
                        <div data-role="zipcode" data-readonly="1" data-name="" data-style="zip"></div>
                        <div data-role="county" data-name="表單名稱" data-style="country"></div>
                        <div data-role="district" data-name="district[]" data-style="district"></div>
                    </div>
                    <input class="addr" name="addr" type="text" placeholder="請輸入地址" />
                </div>
            </div>

            <button type="none" class="profile-submit">確認修改</button>

            <script>
                $(function() {
                    checkMemberLogin(
                        function() {
                            $('#not-login').modal({
                                onHidden: function() {
                                    location.replace("index.html");
                                }
                            }).modal('show');
                        }
                    );
                    loadMemberProfile();
                });

                $('.month').dropdown({
                    values: function() {
                        var monthArry = [];
                        for (var i = 1; i <= 12; i++) {
                            var obj = {};
                            if (i.toString().length == 1) {
                                obj["name"] = "0" + i;
                                obj["value"] = "0" + i;
                            } else {
                                obj["name"] = i.toString();
                                obj["value"] = i.toString();
                            }
                            if (i == 1) {
                                obj["selected"] = true;
                            }
                            monthArry.push(obj);
                        }
                        return monthArry;
                    }()
                }).dropdown();

                $('.day').dropdown({
                    values: function() {
                        var dayArry = [];
                        for (var i = 1; i <= 31; i++) {
                            var obj = {};
                            if (i.toString().length == 1) {
                                obj["name"] = "0" + i;
                                obj["value"] = "0" + i;
                            } else {
                                obj["name"] = i.toString();
                                obj["value"] = i.toString();
                            }
                            if (i == 1) {
                                obj["selected"] = true;
                            }
                            dayArry.push(obj);
                        }
                        return dayArry;
                    }()
                }).dropdown();

                $('input[name="day"]').change(function() {
                    dateValidation($('.year').val(),
                        $('input[name="month"]').val(),
                        $('input[name="day"]').val(),
                        function() {
                            $('#profileNotice1').modal('show');
                            $('.member-birthday .day').dropdown('set selected', "01");
                        });
                });

                $('.twzipcode').twzipcode();

                function dateValidation(yearInput, monthInput, dayInput, callback) {
                    var flag = false;
                    var year = parseInt(yearInput);
                    var month = parseInt(monthInput);
                    var day = parseInt(dayInput);
                    var valArry = [year, month - 1, day];
                    var date = new Date(year, month - 1, day);
                    var dateArry = [date.getFullYear(), date.getMonth(), date.getDate()];
                    $.each(valArry, function(i, v) {
                        if (v == dateArry[i]) {} else {
                            flag = true;
                            callback();
                            return null;
                        }
                    });
                    return flag;
                };


                function cellValidation(cellInput, callback) {
                    var reg = /^\d+$/;
                    var flag = false;
                    var value = cellInput;
                    if (!reg.test(cellInput)) {
                        callback();
                        flag = true;
                    };
                    return flag;
                };

                $('.member-cell input').blur(
                    function() {
                        cellValidation($(this).val(), function() {
                            $('#profileNotice2').modal('show');
                        });
                    }
                );

                function loadMemberProfile() {
                    // Cookies.set("member", member);
                    if (typeof Cookies.get('member') === 'undefined') {
                        console.log('no cookie');
                    } else {
                        console.log(Cookies.get("member"));
                        member = JSON.parse(Cookies.get("member"));
                    };

                    // member = function() {
                    //     var tmp = null;
                    //     $.ajax({
                    //         'type': "POST",
                    //         'url': '<c:url value="/user/member/getMyInfo"/>',
                    //         'success': function(data) {
                    //             tmp = data;
                    //         }
                    //     });
                    //     return tmp;
                    // }();

                    $('.member-id').text(member[0].MemberID);
                    $('.container.profile-content .left>.img-fluid').attr('src',
                        function() {
                            if (member[0].ImgUrl.length == 0) {
                                return 'images/mem-default.png';
                            } else {
                                return member[0].ImgUrl;
                            }
                        }()
                    );
                    $('.member-account span').text(member[0].Mail);
                    $('.member-name input').val(member[0].Name);
                    var rawBirthday = member[0].Birthday;
                    var birthdayArry = rawBirthday.split('-');
                    $('.member-birthday>input').val(birthdayArry[0]);
                    $('.member-birthday .month').dropdown('set selected', birthdayArry[1]);
                    $('.member-birthday .day').dropdown('set selected', birthdayArry[2]);
                    $('.member-cell input').val(member[0].Cell);
                    var rawAddr = member[0].Addr;
                    var addr = [rawAddr.substr(0, 3), rawAddr.substr(rawAddr.indexOf("-") + 1)];
                    $('.member-addr .twzipcode').twzipcode('set', addr[0]);
                    $('.member-addr .addr').val(addr[1]);
                };

                $('.profile-submit').click(
                    function() {
                        // 檢核點1:日期檢核
                        var flag = dateValidation($('.year').val(),
                            $('input[name="month"]').val(),
                            $('input[name="day"]').val(),
                            function() {
                                $('#profileNotice1').modal('show');
                                $('.member-birthday .day').dropdown('set selected', "01");
                            });

                        // 檢核點2:電話檢核
                        flag = cellValidation($('.member-cell input').val(), function() {
                            $('#profileNotice2').modal('show');
                        });

                        if (flag) {
                            return null;
                        };

                        var dataProfile = [{
                            'MemberID': JSON.parse(Cookies.get('member'))[0].MemberID,
                            'Name': $('.member-name input').val(),
                            'Cell': $('.member-cell input').val(),
                            'Mail': JSON.parse(Cookies.get('member'))[0].Mail,
                            'Addr': function() {
                                let addr = '';
                                $.each(
                                    $('.member-addr .twzipcode').twzipcode('get', ['zipcode', 'county', 'district']),
                                    function(i, v) {
                                        addr = addr + v;
                                    }
                                );
                                addr = addr + '-' + $('.member-addr .addr').val();
                                return addr;
                            }(),
                            'Birthday': function() {
                                let birthday = '';
                                let arry = [$('.member-birthday>input').val(),
                                    $('.member-birthday .month input').val(),
                                    $('.member-birthday .day input').val()
                                ];
                                $.each(arry, function(i, v) {
                                    if (arry[0].length == 0) {
                                        return null;
                                    }
                                    if (i == 0) {
                                        birthday = birthday + v;
                                    } else {
                                        birthday = birthday + '-' + v;
                                    }
                                });
                                return birthday;
                            }(),
                            'ImgUrl': $('.container.profile-content .left>.img-fluid').attr('src'),
                            "Bonus": JSON.parse(Cookies.get('member'))[0].Bonus
                        }];
                        console.log(dataProfile);
                        $.ajax({
                            url: '....................',
                            type: "POST",
                            dataType: "json",
                            data: JSON.stringify(dataProfile),
                            success: function(data) {
                                Cookies.set('member', dataProfile);
                                loadMemberProfile();
                                console.log(Cookies.get('member'));
                                $('#profileNotice3').modal('show');
                            },
                            error: function(data) {
                                Cookies.set('member', dataProfile);
                                loadMemberProfile();
                                console.log(Cookies.get('member'));
                                $('#profileNotice4').modal('show');
                            }
                        })
                    }
                );

                $('.member-head').click(
                    function() {
                        $('#profileHead').modal('show');
                    }
                );
            </script>

        </div>

        <!--半共用樣式區，Footer-->
        <footer class="member-common-footer">
            <div class="member-profile">
                <img src="images/profile-animation-1.png" class="img-fluid" alt="" />
                <img src="images/profile-animation-2.png" class="img-fluid" alt="" />
                <img src="images/member-profile-footer-bg.png" class="img-fluid" alt="" />
                <div class="icon-link">
                    <a href="" class="">
                        <img src="images/icon-fb.png" class="img-fluid" alt="" />
                    </a>
                    <a href="" class="">
                        <img src="images/icon-ig.png" class="img-fluid" alt="" />
                    </a>
                    <a href="" class="">
                        <img src="images/icon-utube.png" class="img-fluid" alt="" />
                    </a>
                </div>
                <div class="footer-title">
                    <div class="title">會員資料管理</div>
                    <div class="title">個人資料修改</div>
                </div>
                <div class="footer-link">
                    <a href="news.html" class="wonderfulType nav-link">
                        <div class="title">最新消息</div>
                        <div class="title">News</div>
                    </a>
                    <a href="productIndex.html" class="wonderfulType nav-link">
                        <div class="title">商品專區</div>
                        <div class="title">Products</div>
                    </a>
                    <a href="" class="wonderfulType nav-link">
                        <div class="title">相片底家</div>
                        <div class="title">Photos</div>
                    </a>
                    <a href="story.html" class="wonderfulType nav-link">
                        <div class="title">美好故事</div>
                        <div class="title">About&nbsp;Us</div>
                    </a>
                    <a href="" class="wonderfulType nav-link">
                        <div class="title">美好問答</div>
                        <div class="title">Q&A</div>
                    </a>
                    <a href="contact.html" class="wonderfulType nav-link">
                        <div class="title">找尋美好</div>
                        <div class="title">Find&nbsp;Us</div>
                    </a>
                </div>
            </div>
        </footer>
        <script>
            $('.member-profile .footer-link .nav-link').hover(
                function() {
                    $(this).children('.title:last-child').css('opacity', "1");
                },
                function() {
                    $(this).children('.title:last-child').css('opacity', "0");
                }
            )
        </script>


        <!--頭項選擇Modal-->
        <div id="profileHead" class="ui modal">
            <div class="">
                <div class="close">&times;</div>
                <div class="head-choice-box">
                    <img src="images/m1.png" class="img-fluid" alt="" />
                    <div class="title">帥氣外表、樸實個性，正港台灣因仔。</div>
                    <div class="radio-button">
                        <input type="radio" class="" />
                    </div>
                </div>
                <div class="head-choice-box">
                    <img src="images/fe1.png" class="img-fluid" alt="" />
                    <div class="title">活潑俏麗、青春無敵，可愛鄰家妹妹。</div>
                    <div class="radio-button">
                        <input type="radio" class="" />
                    </div>
                </div>
                <div class="head-choice-box">
                    <img src="images/m2.png" class="img-fluid" alt="" />
                    <div class="title">捲毛雀斑、隨和親近，萌萌混血男孩。</div>
                    <div class="radio-button">
                        <input type="radio" class="" />
                    </div>
                </div>
                <div class="head-choice-box">
                    <img src="images/fe2.png" class="img-fluid" alt="" />
                    <div class="title">氣質長髮、優雅文靜，魅力女神姐姐。</div>
                    <div class="radio-button">
                        <input type="radio" class="" />
                    </div>
                </div>
                <div class="head-choice-box">
                    <img src="images/mem-default.png" class="img-fluid" alt="" />
                    <div class="title">任勞任怨、為愛付出，靈魂人物美好阿嬤。</div>
                    <div class="radio-button">
                        <input type="radio" class="" />
                    </div>
                </div>
                <button type="none" class="head-confirm">選好了</button>
            </div>
        </div>

        <script>
            $('#profileHead .radio-button').click(
                function() {
                    var source = $(this).parents('.head-choice-box').children('.img-fluid').attr('src');
                    $('.container.profile-content .left>.img-fluid').attr('src', source);
                }
            );
            $('#profileHead .head-confirm').click(
                function() {
                    $('#profileHead').modal('hide');
                }
            );
        </script>


        <!--日期不正確Modal-->
        <div id="profileNotice1" class="ui modal">
            <div class="">
                <div class="title">日期不正確，請選擇正確日期。</div>
            </div>
            <button type="none" class="">確定</button>
        </div>
        <script>
            $('#profileNotice1 button').click(
                function() {
                    $(this).parent('#profileNotice1').modal('hide');
                }
            );
        </script>

        <!--電話僅能為數字Modal-->
        <div id="profileNotice2" class="ui modal">
            <div class="">
                <div class="title">連絡電話僅能為數字。</div>
            </div>
            <button type="none" class="">確定</button>
        </div>
        <script>
            $('#profileNotice2 button').click(
                function() {
                    $(this).parent('#profileNotice2').modal('hide');
                }
            );
        </script>

        <!--資料更新成功Modal-->
        <div id="profileNotice3" class="ui modal">
            <div class="">
                <div class="title">資料已更新。</div>
            </div>
            <button type="none" class="">確定</button>
        </div>
        <script>
            $('#profileNotice3 button').click(
                function() {
                    $(this).parent('#profileNotice3').modal('hide');
                }
            );
        </script>

        <!--資料更新失敗Modal-->
        <div id="profileNotice4" class="ui modal">
            <div class="">
                <div class="title">資料更新失敗。</div>
            </div>
            <button type="none" class="">確定</button>
        </div>
        <script>
            $('#profileNotice4 button').click(
                function() {
                    $(this).parent('#profileNotice4').modal('hide');
                }
            );
        </script>

        <!--尚未登入Modal-->
        <div id="not-login" class="ui modal">
            <div class="">
                <div class="title">尚未登入！請先登入。</div>
            </div>
            <button type="none" class="">確定</button>
        </div>
        <script>
            $('#not-login button').click(
                function() {
                    $(this).parent('#not-login').modal('hide');
                }
            );
        </script>
    </div>
</body>

</html>