<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!-- X-UA-Compatible設置IE兼容模式 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <!--RWD-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0" />
    <meta name="author" content="萊茵巴赫科技" />
    <meta name="copyright" content="萊茵巴赫科技" />
    <!-- 結構化資料 SEO 與 meta 標籤 -->
    <meta property="og:title" content="柚美。柚好" />
    <meta property="og:url" content="">
    <meta property="og:image" content="要顯示的縮圖網址" />
    <meta property="og:description" content="網頁描述" />
    <link rel="stylesheet" href="css/normalize.css" />
    <link rel="stylesheet" href="css/style.css" />
    <title>柚美。柚好</title>
    <script src="js/jquery-3.2.1.js"></script>
    <script src="js/semantic.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
    <script src="js/reinbachCommon.js"></script>
</head>

<body style="background: none">
    <!--共用樣式區，sidebar-->
    <div id="memberSidebar" class="ui left vertical inverted sidebar menu">
        <div class="header">美好會員中心</div>
        <div class="sidebar-logo">
            <img src="images/member-sidebar-logo.png" class="img-fluid" alt="" />
        </div>
        <div class="section-header">會員資料管理</div>
        <div class="profile-manage">
            <a class="item nav-link" href="memberProfile.html">個人資料修改</a>
            <a class="item nav-link" href="memberResetPwd.html">密碼修改</a>
        </div>
        <div class="section-header">會員訂單管理</div>
        <div class="order-manage">
            <a class="item nav-link" href="memberMyOrder.html">我的訂單</a>
            <a class="item nav-link" href="">退貨申請</a>
            <a class="item nav-link" href="">修改訂單</a>
            <a class="item nav-link" href="">取消訂單</a>
        </div>
        <div class="section-header">紅利與購物金</div>
        <div class="bonus-funds-manage">
            <a class="item nav-link" href="memberBonus.html">紅利回饋</a>
            <a class="item nav-link" href="memberFunds.html">購物金</a>
        </div>
        <div class="section-header">購物小幫手</div>
        <div class="order-help">
            <a class="item nav-link" href="memberHelper1.html">紅利回饋與購物金說明</a>
            <a class="item nav-link" href="memberHelper2.html">購物流程</a>
            <a class="item nav-link" href="memberHelper3.html">服務條款與隱私政策</a>
        </div>
    </div>
    <script>
        $('#memberSidebar .item').hover(
            function() {
                $(this).children('.img-fluid').css('opacity', '1');
            },
            function() {
                $(this).children('.img-fluid').css('opacity', '0');
            }
        );
    </script>

    <div class="pusher" style="position:relative">
        <!--共用樣式區，Header-->
        <header>
            <nav class="nav member-common-menu">
                <img src="images/order-bounce-logo1.png" class="img-fluid bounce-logo" alt="" />
                <div class="hamburger">&#9776;</div>
                <a href="index.html" class="order-check-site-logo">
                    <img src="images/webLogo-order-check.png" class="img-fluid" alt="" />
                </a>
                <img src="images/order-bounce-logo2.png" class="img-fluid bounce-logo" alt="" />
            </nav>
        </header>
        <script>
            $('.member-common-menu .hamburger').click(
                function() {
                    $('#memberSidebar').sidebar('toggle');
                }
            );
            $('.member-common-menu .order-check-site-logo').hover(
                function() {
                    $(this).parent('.member-common-menu').children('.bounce-logo').toggleClass('rotate360');
                },
                function() {
                    $(this).parent('.member-common-menu').children('.bounce-logo').toggleClass('rotate360');
                }
            );
        </script>


        <div class="container my-order-record">
            <div class="index"></div>
            <table class="record-table">
            </table>

            <div class="paging">
                <img src="images/dot-left.png" class="img-fluid" alt="" />
                <img src="images/dot-right.png" class="img-fluid" alt="" />
            </div>
        </div>

        <script>
            var testMyOrderList = [{
                "OrderID": "O000000001",
                "OrdTime": "2018.05.31",
                "Status": "待付款"
            }, {
                "OrderID": "O000000002",
                "OrdTime": "2018.05.31",
                "Status": "待出貨"
            }, {
                "OrderID": "O000000003",
                "OrdTime": "2018.05.29",
                "Status": "已付款"
            }, {
                "OrderID": "O000000004",
                "OrdTime": "2018.05.15",
                "Status": "已出貨"
            }, {
                "OrderID": "O000000005",
                "OrdTime": "2018.05.01",
                "Status": "逾期未付款"
            }, {
                "OrderID": "O000000006",
                "OrdTime": "2018.04.28",
                "Status": "取消訂單"
            }, {
                "OrderID": "O000000007",
                "OrdTime": "2018.04.26",
                "Status": "逾期未付款"
            }, {
                "OrderID": "O000000008",
                "OrdTime": "2018.04.13",
                "Status": "已出貨"
            }, {
                "OrderID": "O000000009",
                "OrdTime": "2018.04.05",
                "Status": "已出貨"
            }, {
                "OrderID": "O000000010",
                "OrdTime": "2018.03.29",
                "Status": "已出貨"
            }, {
                "OrderID": "O000000011",
                "OrdTime": "2018.03.17",
                "Status": "逾期未付款"
            }];

            var testCargoList = [{
                "CargoID": "C00000001",
                "CargoName": "大榮貨運",
                "Url": "https://www.kerrytj.com/zh/search/search_track.aspx",
                "Contract": "Yes"
            }];


            var myOrderList;
            var cargoList;
            $(function() {

                // $.post('<c:url value="/user/order/getMyOrders"/>', function(data) {
                //     myOrderList = data;
                // });

                // $.post('<c:url value="/user/order/getCargolux>', function(data) {
                //     cargoList = data;
                // });

                myOrderList = testMyOrderList;
                cargoList = testCargoList;

                // 如果查詢無資料時
                if (myOrderList != null) {
                    loadMyOrder(myOrderList, 0);
                } else {
                    noMyOrderList();
                    $('.paging .img-fluid').css('display', 'none');
                };


            });

            //動態生成資料
            //有My Order List時
            function loadMyOrder(jsonDataIn, startIndex) {
                if (startIndex > jsonDataIn.length) {
                    startIndex = startIndex - 5;
                }
                if (startIndex < 0) {
                    startIndex = 0;
                };
                $('.record-table').text('');
                $('.container.my-order-record .index').text(startIndex);
                var trArry = [];
                let head = $('<tr></tr>').addClass('head-of-table').append([
                    $('<th></th>').text('訂單編號'),
                    $('<th></th>').text('訂購日期'),
                    $('<th></th>').text('訂單狀態'),
                    $('<th></th>').text('配送進度'),
                    $('<th></th>').text('詢問紀錄'),
                    $('<th></th>').text('我的評論'),
                    $('<th></th>').text('我已匯款')
                ]);
                trArry.push(head);
                for (let i = startIndex; i < (startIndex + 5); i++) {
                    var row;
                    if (i > jsonDataIn.length - 1) {
                        row = $('<tr></tr>').append([
                            $('<td></td>').html('&nbsp;'),
                            $('<td></td>').html('&nbsp;'),
                            $('<td></td>').html('&nbsp;'),
                            $('<td></td>').html('&nbsp;'),
                            $('<td></td>').html('&nbsp;'),
                            $('<td></td>').html('&nbsp;'),
                            $('<td></td>').html('&nbsp;')
                        ]);
                    } else {
                        row = $('<tr></tr>').append([
                            $('<td></td>').text(jsonDataIn[i].OrderID).click(function() {
                                location.href = 'memberOrderDetail.html?orderID=' + $(this).text();
                            }),
                            $('<td></td>').text(jsonDataIn[i].OrdTime),
                            $('<td></td>').text(jsonDataIn[i].Status),
                            $('<td></td>').append($('<img/>').attr({
                                'src': 'images/member-view.png',
                                'onclick': 'loadCaroInfo(this)'
                            }).css('display', function() {
                                if (jsonDataIn[i].Status === "已出貨") {
                                    return "block";
                                } else {
                                    return "none";
                                }
                            }()).addClass('img-fluid')),
                            $('<td></td>').append($('<img/>').attr('src', 'images/member-mailus.png').addClass('img-fluid').click(
                                function() {
                                    console.log($(this).parents('tr').find('td:nth-child(1)').text());
                                    location.href = 'memberOrderQA.html?orderID=' + $(this).parents('tr').find('td:nth-child(1)').text();
                                }
                            )),
                            $('<td></td>').append($('<img/>').attr('src', 'images/member-give-comment.png').addClass('img-fluid').click(
                                function() {
                                    console.log($(this).parents('tr').find('td:nth-child(1)').text());
                                    location.href = 'memberOrderComment.html?orderID=' + $(this).parents('tr').find('td:nth-child(1)').text();
                                }
                            )),
                            $('<td></td>').append($('<img/>').css('display', function() {
                                if (jsonDataIn[i].Status === "取消訂單" || jsonDataIn[i].Status === "逾期未付款") {
                                    return "none";
                                } else {
                                    return "block";
                                }
                            }()).attr('src', 'images/member-bank-account.png').addClass('img-fluid').click(
                                function() {
                                    console.log($(this).parents('tr').find('td:nth-child(1)').text());
                                    location.href = 'memberOrderPayAccount.html?orderID=' + $(this).parents('tr').find('td:nth-child(1)').text();
                                }
                            ))
                        ])
                    };
                    trArry.push(row);
                }
                $('.record-table').append(trArry);
            };


            //無My Order List時
            function noMyOrderList() {
                let head = $('<tr></tr>').addClass('head-of-table').append([
                    $('<th></th>').text('訂單編號'),
                    $('<th></th>').text('訂購日期'),
                    $('<th></th>').text('訂單狀態'),
                    $('<th></th>').text('配送進度'),
                    $('<th></th>').text('詢問紀錄'),
                    $('<th></th>').text('我的評論'),
                    $('<th></th>').text('我已匯款')
                ]);
                let noData = $('<tr></tr>').attr('rowspan', '5').append($('<td></td>').css('padding', '10% 0').attr('colspan', '7').text('目前尚無紀錄。'));
                $('.record-table').append([head, noData]);
            };

            // 下5筆
            $('.paging .img-fluid:last-child').click(function() {
                loadMyOrder(myOrderList, parseInt($('.container.my-order-record .index').text()) + 5);
            });

            // 上5筆
            $('.paging .img-fluid:first-child').click(function() {
                loadMyOrder(myOrderList, parseInt($('.container.my-order-record .index').text()) - 5);
            });


            //點擊出現貨運行相關資訊
            function loadCaroInfo(clickSelf) {
                if ($('.service-number') != "undefined") {
                    $('.service-number').remove();
                };

                $("#myOrderCargoUrl .title:nth-child(1)").text('等待配送中');
                $("#myOrderCargoUrl .title:nth-child(3) span").text(cargoList[0].CargoName);
                $("#myOrderCargoUrl .title:nth-child(4) a").attr({
                    'href': cargoList[0].Url,
                    'target': '_blank'
                }).text('點我查詢');

                let serviceNumber;

                // $.post('<c:url value="/user/delivery/getDeliveryByOrderID"/>', {
                //     "orderID": $(this).parents('tr').find('td:nth-child(1)').text()
                // }, function(data) {
                //     serviceNumber = data;
                // });

                serviceNumber = [{
                    "ServiceNumber": "105062287548977",
                    "Name": "鈴木保奈美"
                }, {
                    "ServiceNumber": "105062287548980",
                    "Name": "妻夫木聰"
                }, {
                    "ServiceNumber": "105062287548999",
                    "Name": "王力宏"
                }, {
                    "ServiceNumber": "105062287548922",
                    "Name": "北川景子"
                }, {
                    "ServiceNumber": "105062287548977",
                    "Name": "石原聰美"
                }];

                let arry = [];
                if (serviceNumber.length != 0) {
                    arry.push($('<div></div>').addClass('title').text('配送人與託運單號：'));
                    $.each(serviceNumber, function(i, v) {
                        let row = $('<div></div>').addClass('title').text("-" + v.Name).append($('<span></span>').text(v.ServiceNumber));
                        arry.push(row);
                    });

                };

                $("#myOrderCargoUrl .title:nth-child(4)").after($('<div></div>').addClass('service-number').append(arry));

                $("#myOrderCargoUrl").modal("show");
            };
        </script>


        <!--半共用樣式區，Footer-->
        <footer class=" member-common-footer">
            <div class="member-myOrder animation-1">
                <img src="images/member-myorder-animation-1.png" class="img-fluid" alt="" />
                <img src="images/member-myorder-animation-2.png" class="img-fluid" alt="" />
                <img src="images/member-myorder-footer-bg.png " class="img-fluid " alt=" " />
                <div class="icon-link ">
                    <a href=" " class=" ">
                        <img src="images/icon-fb.png " class="img-fluid " alt=" " />
                    </a>
                    <a href=" " class=" ">
                        <img src="images/icon-ig.png " class="img-fluid " alt=" " />
                    </a>
                    <a href=" " class=" ">
                        <img src="images/icon-utube.png " class="img-fluid " alt=" " />
                    </a>
                </div>
                <div class="footer-title ">
                    <div class="title ">會員訂單管理</div>
                    <div class="title ">我的訂單</div>
                </div>
                <div class="footer-link ">
                    <a href="news.html " class="wonderfulType nav-link ">
                        <div class="title ">最新消息</div>
                        <div class="title ">News</div>
                    </a>
                    <a href="productIndex.html " class="wonderfulType nav-link ">
                        <div class="title ">商品專區</div>
                        <div class="title ">Products</div>
                    </a>
                    <a href=" " class="wonderfulType nav-link ">
                        <div class="title ">相片底家</div>
                        <div class="title ">Photos</div>
                    </a>
                    <a href="story.html " class="wonderfulType nav-link ">
                        <div class="title ">美好故事</div>
                        <div class="title ">About&nbsp;Us</div>
                    </a>
                    <a href=" " class="wonderfulType nav-link ">
                        <div class="title ">美好問答</div>
                        <div class="title ">Q&A</div>
                    </a>
                    <a href="contact.html " class="wonderfulType nav-link ">
                        <div class="title ">找尋美好</div>
                        <div class="title ">Find&nbsp;Us</div>
                    </a>
                </div>
            </div>
        </footer>
        <script>
            $('.member-myOrder .footer-link .nav-link').hover(
                function() {
                    $(this).children('.title:last-child').css('opacity', "1 ");
                },
                function() {
                    $(this).children('.title:last-child').css('opacity', "0 ");
                }
            );
        </script>


        <div id="myOrderCargoUrl" class="ui modal">
            <div class="title"></div>
            <hr/>
            <div class="title">配送單位：<span></span></div>
            <div class="title">查詢網址：
                <a href=""></a>
            </div>
            <button class="" type="none">關閉</button>
        </div>

        <script>
            $('#myOrderCargoUrl button').click(
                function() {
                    $('#myOrderCargoUrl').modal('hide');
                }
            )
        </script>

    </div>
</body>

</html>