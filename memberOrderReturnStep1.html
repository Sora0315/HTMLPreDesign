<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!-- X-UA-Compatible設置IE兼容模式 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <!--RWD-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0" />
    <meta name="author" content="萊茵巴赫科技" />
    <meta name="copyright" content="萊茵巴赫科技" />
    <!-- 結構化資料 SEO 與 meta 標籤 -->
    <meta property="og:title" content="柚美。柚好" />
    <meta property="og:url" content="">
    <meta property="og:image" content="要顯示的縮圖網址" />
    <meta property="og:description" content="網頁描述" />
    <link rel="stylesheet" href="css/normalize.css" />
    <link rel="stylesheet" href="css/style.css" />
    <title>柚美。柚好</title>
    <script src="js/jquery-3.2.1.js"></script>
    <script src="js/semantic.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
    <script src="js/reinbachCommon.js"></script>
</head>

<body style="background: none">
    <!--共用樣式區，sidebar-->
    <div id="memberSidebar" class="ui left vertical inverted sidebar menu">
        <div class="header">美好會員中心</div>
        <div class="sidebar-logo">
            <img src="images/member-sidebar-logo.png" class="img-fluid" alt="" />
        </div>
        <div class="section-header">會員資料管理</div>
        <div class="profile-manage">
            <a class="item nav-link" href="memberProfile.html">個人資料修改</a>
            <a class="item nav-link" href="memberResetPwd.html">密碼修改</a>
        </div>
        <div class="section-header">會員訂單管理</div>
        <div class="order-manage">
            <a class="item nav-link" href="memberMyOrder.html">我的訂單</a>
            <a class="item nav-link" href="memberOrderReturnIndex.html">退貨申請</a>
            <a class="item nav-link" href="memberOrderCancel.html">取消訂單</a>
        </div>
        <div class="section-header">紅利與購物金</div>
        <div class="bonus-funds-manage">
            <a class="item nav-link" href="memberBonus.html">紅利回饋</a>
            <a class="item nav-link" href="memberFunds.html">購物金</a>
        </div>
        <div class="section-header">購物小幫手</div>
        <div class="order-help">
            <a class="item nav-link" href="memberHelper1.html">紅利回饋與購物金說明</a>
            <a class="item nav-link" href="memberHelper2.html">購物流程</a>
            <a class="item nav-link" href="memberHelper3.html">服務條款與隱私政策</a>
        </div>
    </div>
    <script>
        $('#memberSidebar .item').hover(
            function() {
                $(this).children('.img-fluid').css('opacity', '1');
            },
            function() {
                $(this).children('.img-fluid').css('opacity', '0');
            }
        );
    </script>

    <div class="pusher" style="position:relative">
        <!--共用樣式區，Header-->
        <header>
            <nav class="nav member-common-menu">
                <img src="images/order-bounce-logo1.png" class="img-fluid bounce-logo" alt="" />
                <div class="hamburger">&#9776;</div>
                <a href="index.html" class="order-check-site-logo">
                    <img src="images/webLogo-order-check.png" class="img-fluid" alt="" />
                </a>
                <img src="images/order-bounce-logo2.png" class="img-fluid bounce-logo" alt="" />
            </nav>
        </header>
        <script>
            $('.member-common-menu .hamburger').click(
                function() {
                    $('#memberSidebar').sidebar('toggle');
                }
            );
            $('.member-common-menu .order-check-site-logo').hover(
                function() {
                    $(this).parent('.member-common-menu').children('.bounce-logo').toggleClass('rotate360');
                },
                function() {
                    $(this).parent('.member-common-menu').children('.bounce-logo').toggleClass('rotate360');
                }
            );
        </script>


        <div class="container return-step1 return-step-common">
            <div class="steps-bar">
                <img src="images/return-step-bar-1.png" class="img-fluid" alt="" />
            </div>
            <div class="title">請勾選欲退換貨的配送明細<span>(先勾選欲退換貨的配送明細，再選擇退換商品的數量。)</span></div>
            <div class="select-all">
                <div class="boolean">0</div>
                <div class="select-icon"></div>
                <div class="title">所有配送明細</div>
            </div>

            <table class="delivery-detail">
            </table>

            <button type="none" class="submit">下一步</button>
            <script>
                testReturnDelivery = [{
                    "ReceiptID": "R000000001",
                    "Name": "松島聰",
                    "Cell": "0922333555",
                    "Addr": '新北市永和區永和路二段255巷135弄6號2樓2055室',
                    "DeliveryList": [{
                        "DeliveryID": "D000000001",
                        "ProductID": "P000000001",
                        "Name": "十斤裝手提文旦禮盒(嚴選40年老欉)",
                        "ImgUrl": "images/pomelo-2.png",
                        "Price": 675,
                        "Qty": 3
                    }]
                }, {
                    "ReceiptID": "R000000003",
                    "Name": "坂井泉水",
                    "Cell": "0911558798",
                    "Addr": '台北市中正區羅斯福路路二段125巷235號7樓',
                    "DeliveryList": [{
                        "ProductID": "P000000003",
                        "DeliveryID": "D000000002",
                        "Name": "手提束口禮袋+明信片",
                        "ImgUrl": "images/pomelo-4.png",
                        "Price": 350,
                        "Qty": 5
                    }, {
                        "ProductID": "P000000004",
                        "DeliveryID": "D000000003",
                        "Name": "五斤裝手提文旦禮盒(嚴選40年老欉)",
                        "ImgUrl": "images/pomelo-3.png",
                        "Price": 400,
                        "Qty": 1
                    }]
                }];



                // 選擇圓圈的高度隨著視窗寬度而定resize
                $(window).resize(
                    function() {
                        returnStep1SelectCircleHeight();
                    }
                );

                // 選擇圓圈的高度隨著視窗寬度而定
                function returnStep1SelectCircleHeight() {
                    $('.container.return-step1 .select-all>.select-icon').css('height', function() {
                        return $('.container.return-step1 .select-all').width() * 0.025;
                    }());
                    $('.container.return-step1 .delivery-detail .delivery .all-products .products .select .select-icon').css('height', function() {
                        return $('.container.return-step1 .delivery-detail .delivery .all-products .products .select').width() * 0.39;
                    }());
                };

                //增加退貨數量
                function addReturnQty(e) {
                    let max = parseInt($(e).parents('.option').find('.max').text());
                    let currentNumber = parseInt($(e).parents('.option').find('.number').text());
                    if (currentNumber + 1 > max) {

                    } else {
                        $(e).parents('.option').find('.number').text(currentNumber + 1);
                    }
                };

                //減少退貨數量
                function minusReturnQty(e) {
                    let min = 1;
                    let currentNumber = parseInt($(e).parents('.option').find('.number').text());
                    if (currentNumber - 1 < min) {

                    } else {
                        $(e).parents('.option').find('.number').text(currentNumber - 1);
                    }
                };

                // 載入配送明細與退貨資訊
                function loadReturnDelivery(jsonDataIn) {
                    var returnStep1Table = $('.delivery-detail');
                    $('.delivery-detail tr').remove();
                    deliveryArry = [];
                    $.each(jsonDataIn,
                        function(i, v) {
                            let index = $('<td></td>').addClass('index').text(i + 1);
                            //收件人資訊
                            let receipt = $('<td></td>').addClass('receipt').append([
                                $('<div></div>').addClass('name').text('姓名：').append($('<span></span>').text(v.Name)),
                                $('<div></div>').addClass('cell').text('連絡電話：').append($('<span></span>').text(v.Cell)),
                                $('<div></div>').addClass('addr').text('收貨地址：').append($('<span></span>').text(v.Addr))
                            ]);

                            let products = [];
                            // 配送的商品資訊與數量
                            $.each(v.DeliveryList, function(index, value) {
                                // 商品圖片
                                let left = $('<td></td>').addClass('left').append($('<img/>').addClass('img-fluid').attr('src', value.ImgUrl));
                                // 商品名稱，售價，配送編號
                                let right = $('<td></td>').addClass('right').append([
                                    $('<div></div>').addClass('id').text(value.ProductID),
                                    $('<div></div>').addClass('name').text(value.Name),
                                    $('<div></div>').addClass('sell-price').text('售價：$').append($('<span></span>').text(value.Price)),
                                    $('<div></div>').addClass('delivery-id').text(value.DeliveryID)
                                ]);
                                // 退貨數量選擇
                                let option = $('<td></td>').addClass('option').append([
                                    $('<div></div>').addClass('title').html('請選擇<br/>退貨數量'),
                                    $('<div></div>').addClass('number-select').append([
                                        $('<img/>').addClass('img-fluid').attr({
                                            'src': 'images/return-add.png',
                                            'onclick': 'addReturnQty(this)'
                                        }),
                                        $('<div></div>').addClass('max').text(value.Qty),
                                        $('<div></div>').addClass('number').text(value.Qty),
                                        $('<img/>').addClass('img-fluid').attr({
                                            'src': 'images/return-minus.png',
                                            'onclick': 'minusReturnQty(this)'
                                        }),
                                    ])
                                ]);
                                // 是否退貨選擇ion
                                let select = $('<td></td>').addClass('select').append([
                                    $('<div></div>').addClass('boolean').text('0'),
                                    $('<div></div>').addClass('select-icon').attr('onclick', 'returnSelection(this)')
                                ]);

                                let product = $('<tr></tr>').addClass('product').append([left, right, option, select]);
                                products.push(product);
                            });

                            let allProducts = $('<td></td>').addClass('all-products').append($('<table></table>').addClass('products').append(products));

                            let delivery = $('<tr></tr>').addClass('delivery').append(index, receipt, allProducts);

                            deliveryArry.push(delivery);
                        }
                    );
                    returnStep1Table.append(deliveryArry);
                    returnStep1SelectCircleHeight();
                };

                $(function() {
                    loadReturnDelivery(testReturnDelivery);
                });

                $('.container.return-step1 .select-all>.select-icon').click(
                    function() {
                        if ($(this).parents('.select-all').children('.boolean').text() == "0") {
                            $(this).html('&#10004;').addClass('selected-circle');
                            $(this).parents('.select-all').children('.boolean').text("1");
                            $('.container.return-step1 .delivery-detail .delivery .all-products .products .select .select-icon').each(
                                function() {
                                    $(this).html('<span>&nbsp;</span>&#10004;').addClass('selected-circle');
                                    $(this).parent('.select').children('.boolean').text('1');
                                }
                            );
                        } else {
                            $(this).html('').removeClass('selected-circle');
                            $(this).parents('.select-all').children('.boolean').text("0");
                            $('.container.return-step1 .delivery-detail .delivery .all-products .products .select .select-icon').each(
                                function() {
                                    $(this).html('').removeClass('selected-circle');
                                    $(this).parent('.select').children('.boolean').text('0');
                                }
                            );
                        }
                    }
                );

                //click選擇退貨標的
                function returnSelection(e) {
                    if ($(e).parent('.select').children('.boolean').text() == "0") {
                        $(e).html('<span>&nbsp;</span>&#10004;').addClass('selected-circle');
                        $(e).parent('.select').children('.boolean').text("1");
                    } else {
                        $(e).html('').removeClass('selected-circle');
                        $(e).parent('.select').children('.boolean').text("0");
                        $('.container.return-step1 .select-all>.select-icon').html('').removeClass('selected-circle');
                        $('.container.return-step1 .select-all>.select-icon').parents('.select-all').children('.boolean').text("0");
                    }
                };

                $('.container.return-step1 .delivery-detail .delivery .all-products .products .option .number-select .img-fluid:nth-child(1)').hover(
                    function() {
                        $(this).attr('src', 'images/return-add-hover.png');
                    },
                    function() {
                        $(this).attr('src', 'images/return-add.png');
                    }
                );
                $('.container.return-step1 .delivery-detail .delivery .all-products .products .option .number-select .img-fluid:nth-child(3)').hover(
                    function() {
                        $(this).attr('src', 'images/return-minus-hover.png');
                    },
                    function() {
                        $(this).attr('src', 'images/return-minus.png');
                    }
                );

                $('.container.return-step1.return-step-common .submit').click(
                    function() {
                        if (typeof Cookies.get('returnExchange') != "undefined") {
                            Cookies.remove('returnExchange')
                        };
                        let dataList = [];
                        $('.product').each(function(i, v) {
                            if ($(this).find('.boolean').text() == "1") {
                                let returnObj = {
                                    "deliveryID": $(this).find('.right .delivery-id').text(),
                                    "returnQty": $(this).find('.number-select .number').text(),
                                    "refundType": "",
                                    "deliveryName": $(this).parents('.delivery').find('.receipt .name span').text(),
                                    "deliveryCell": $(this).parents('.delivery').find('.receipt .cell span').text(),
                                    "deliveryAddr": $(this).parents('.delivery').find('.receipt .addr span').text(),
                                    "returnProductID": $(this).find('.right .id').text(),
                                    "returnProductName": $(this).find('.right .name').text(),
                                    "returnProductPrice": $(this).find('.right .sell-price span').text(),
                                    "returnProductImg": $(this).find('.left .img-fluid').attr('src')
                                };
                                dataList.push(returnObj);
                            };
                        });
                        //在有選擇退貨的狀況下
                        if (dataList.length != 0) {
                            Cookies.set('returnExchange', dataList);
                            console.log(Cookies.get('returnExchange'));
                            location.href = 'memberOrderReturnStep2.html?orderID=' + location.search.substr(location.search.indexOf('=') + 1);
                        } else {
                            $('#returnStepNotice .title').text('退貨至少選擇一項配送商品。');
                            $('#returnStepNotice').modal('show');
                        }
                    }
                );
            </script>
        </div>


        <!--半共用樣式區，Footer-->
        <footer class=" member-common-footer">
            <div class="member-order-return-step-common step1">
                <img src="images/return-animation-1.png" class="img-fluid" alt="" />
                <img src="images/dark-cloud.png" class="img-fluid" alt="" />
                <img src="images/rain-light.png" class="img-fluid" alt="" />
                <img src="images/rain-heavy.png" class="img-fluid" alt="" />
                <img src="images/rain-light.png" class="img-fluid" alt="" />
                <img src="images/rain-heavy.png" class="img-fluid" alt="" />
                <img src="images/rain-light.png" class="img-fluid" alt="" />
                <img src="images/rain-heavy.png" class="img-fluid" alt="" />
                <img src="images/member-myorder-footer-bg.png " class="img-fluid " alt=" " />
                <div class="icon-link ">
                    <a href=" " class=" ">
                        <img src="images/icon-fb.png " class="img-fluid " alt=" " />
                    </a>
                    <a href=" " class=" ">
                        <img src="images/icon-ig.png " class="img-fluid " alt=" " />
                    </a>
                    <a href=" " class=" ">
                        <img src="images/icon-utube.png " class="img-fluid " alt=" " />
                    </a>
                </div>
                <div class="footer-title ">
                    <div class="title ">會員訂單管理</div>
                    <div class="title ">退貨申請：選擇商品</div>
                </div>
                <div class="footer-link ">
                    <a href="news.html " class="wonderfulType nav-link ">
                        <div class="title ">最新消息</div>
                        <div class="title ">News</div>
                    </a>
                    <a href="productIndex.html " class="wonderfulType nav-link ">
                        <div class="title ">商品專區</div>
                        <div class="title ">Products</div>
                    </a>
                    <a href=" " class="wonderfulType nav-link ">
                        <div class="title ">相片底家</div>
                        <div class="title ">Photos</div>
                    </a>
                    <a href="story.html " class="wonderfulType nav-link ">
                        <div class="title ">美好故事</div>
                        <div class="title ">About&nbsp;Us</div>
                    </a>
                    <a href=" " class="wonderfulType nav-link ">
                        <div class="title ">美好問答</div>
                        <div class="title ">Q&A</div>
                    </a>
                    <a href="contact.html " class="wonderfulType nav-link ">
                        <div class="title ">找尋美好</div>
                        <div class="title ">Find&nbsp;Us</div>
                    </a>
                </div>
            </div>
        </footer>
        <script>
            $('.member-order-return-step-common .footer-link .nav-link').hover(
                function() {
                    $(this).children('.title:last-child').css('opacity', "1 ");
                },
                function() {
                    $(this).children('.title:last-child').css('opacity', "0 ");
                }
            );
        </script>
    </div>
    <div class="ui modal" id="returnStepNotice">
        <div class="title"></div>
        <hr />
        <button type="none" class="submit">關閉</button>
    </div>
    <script>
        $('#returnStepNotice .submit').click(
            function() {
                $('#returnStepNotice').modal('hide');
            }
        )
    </script>
</body>

</html>