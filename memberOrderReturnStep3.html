<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!-- X-UA-Compatible設置IE兼容模式 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <!--RWD-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0" />
    <meta name="author" content="萊茵巴赫科技" />
    <meta name="copyright" content="萊茵巴赫科技" />
    <!-- 結構化資料 SEO 與 meta 標籤 -->
    <meta property="og:title" content="柚美。柚好" />
    <meta property="og:url" content="">
    <meta property="og:image" content="要顯示的縮圖網址" />
    <meta property="og:description" content="網頁描述" />
    <link rel="stylesheet" href="css/normalize.css" />
    <link rel="stylesheet" href="css/style.css" />
    <title>柚美。柚好</title>
    <script src="js/jquery-3.2.1.js"></script>
    <script src="js/semantic.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
    <script src="js/reinbachCommon.js"></script>
</head>

<body style="background: none">
    <!--共用樣式區，sidebar-->
    <div id="memberSidebar" class="ui left vertical inverted sidebar menu">
        <div class="header">美好會員中心</div>
        <div class="sidebar-logo">
            <img src="images/member-sidebar-logo.png" class="img-fluid" alt="" />
        </div>
        <div class="section-header">會員資料管理</div>
        <div class="profile-manage">
            <a class="item nav-link" href="memberProfile.html">個人資料修改</a>
            <a class="item nav-link" href="memberResetPwd.html">密碼修改</a>
        </div>
        <div class="section-header">會員訂單管理</div>
        <div class="order-manage">
            <a class="item nav-link" href="memberMyOrder.html">我的訂單</a>
            <a class="item nav-link" href="memberOrderReturnIndex.html">退貨申請</a>
            <a class="item nav-link" href="memberOrderCancel.html">取消訂單</a>
        </div>
        <div class="section-header">紅利與購物金</div>
        <div class="bonus-funds-manage">
            <a class="item nav-link" href="memberBonus.html">紅利回饋</a>
            <a class="item nav-link" href="memberFunds.html">購物金</a>
        </div>
        <div class="section-header">購物小幫手</div>
        <div class="order-help">
            <a class="item nav-link" href="memberHelper1.html">紅利回饋與購物金說明</a>
            <a class="item nav-link" href="memberHelper2.html">購物流程</a>
            <a class="item nav-link" href="memberHelper3.html">服務條款與隱私政策</a>
        </div>
    </div>
    <script>
        $('#memberSidebar .item').hover(
            function() {
                $(this).children('.img-fluid').css('opacity', '1');
            },
            function() {
                $(this).children('.img-fluid').css('opacity', '0');
            }
        );
    </script>

    <div class="pusher" style="position:relative">
        <!--共用樣式區，Header-->
        <header>
            <nav class="nav member-common-menu">
                <img src="images/order-bounce-logo1.png" class="img-fluid bounce-logo" alt="" />
                <div class="hamburger">&#9776;</div>
                <a href="index.html" class="order-check-site-logo">
                    <img src="images/webLogo-order-check.png" class="img-fluid" alt="" />
                </a>
                <img src="images/order-bounce-logo2.png" class="img-fluid bounce-logo" alt="" />
            </nav>
        </header>
        <script>
            $('.member-common-menu .hamburger').click(
                function() {
                    $('#memberSidebar').sidebar('toggle');
                }
            );
            $('.member-common-menu .order-check-site-logo').hover(
                function() {
                    $(this).parent('.member-common-menu').children('.bounce-logo').toggleClass('rotate360');
                },
                function() {
                    $(this).parent('.member-common-menu').children('.bounce-logo').toggleClass('rotate360');
                }
            );
        </script>


        <div class="container return-step3 return-step-common">
            <div class="steps-bar">
                <img src="images/return-step-bar-3.png" class="img-fluid" alt="" />
                <a href="" class="back-return-step">Step1選擇商品</a>
                <a href="" class="back-return-step">Step2商品處理方式</a>
            </div>
            <div class="title">請填寫退款資料</div>
            <div class="selection">
                <div class="boolean">0</div>
                <div class="select-icon" onclick="returnFundsMethod(this)"></div>
                <div class="title">
                    <span>線上購物金</span>
                    <span>您可以使用線上購物金於下次購物時直接折抵。</span>柚美柚好收到您的申請後， 約需花費7~10個工作天處理，退款成功後將發送e-mail通知。此款項將會退回您的線上帳戶，您可至「訂單相關查詢- 紅利及購物金查詢」確認。
                </div>
            </div>
            <div class="selection">
                <div class="boolean">0</div>
                <div class="select-icon" onclick="returnFundsMethod(this)"></div>
                <div class="title">
                    <span>匯款</span>
                    <span>請提供您的匯款戶名。</span>柚美柚好收到您的申請後，約需花費7~10個工作天處理，退款成功後將發送e-mail通知。
                    <div class="sub-title">銀行代碼：<span></span></div>
                    <div class="sub-title">帳號：<span></span></div>
                    <div class="sub-title">戶名：<input class="" type="text" placeholder="" /></div>
                </div>
            </div>

            <button class="submit" type="none">下一步</button>
        </div>

        <script>
            var testMeberOrderPayAccountRecrod = [{
                "OrderID": location.search.substr(location.search.indexOf('=') + 1),
                "Total": 3588,
                "Discount": "550",
                "Bank": "013",
                "Account": "95587251470025",
                "PayTime": "2018-07-10"
            }];

            var memberOrderPayAccountRecrod;

            $(function() {
                returnStep3SelectCircleHeight();
                returnStepsBarHeight();
                generateUrlOfReturnSteps();
                memberOrderPayAccountRecrod = testMeberOrderPayAccountRecrod;
                // $.post('<c:url value="/order/getOneOrder">', {
                //     "orderID": location.search.substr(location.search.indexOf('=') + 1)
                // }, function(data) {
                //     memberOrderPayAccountRecrod = data;
                // });
                loadReturnAccount(memberOrderPayAccountRecrod);
                console.log(Cookies.get('returnExchange'));
            });

            // 選擇圓圈的高度隨著視窗寬度而定resize
            $(window).resize(
                function() {
                    returnStepsBarHeight();
                    returnStep3SelectCircleHeight();
                }
            );

            // 選擇圓圈的高度隨著視窗寬度而定
            function returnStep3SelectCircleHeight() {
                $('.container.return-step3 .selection .select-icon').css('height', function() {
                    return $('.container.return-step3 .selection .select-icon').width() * 1.35;
                }());
            };

            // 設定Step Bar連結的高度
            function returnStepsBarHeight() {
                $('.container.return-step-common .steps-bar .back-return-step').css('height', function() {
                    return $('.container.return-step-common .steps-bar .img-fluid').height();
                }());
            };

            // 設定Step Bar的每一個連結導向
            function generateUrlOfReturnSteps() {
                let orderID = location.search.substr(location.search.indexOf('=') + 1);
                $('.container.return-step-common .steps-bar .back-return-step').each(function(i, v) {
                    $(this).attr('href', '/memberOrderReturnStep' + (i + 1) + '.html?orderID=' + orderID);
                });
            };

            // click 選擇退款方式
            function returnFundsMethod(e) {
                $('.container.return-step3 .selection .select-icon').each(
                    function() {
                        $(this).html('').removeClass('selected-circle');;
                        $(this).parents('.selection').find('.boolean').text("0");
                    }
                );
                if ($(e).parents('.selection').children('.boolean').text() == "0") {
                    $(e).html('&#10004;').addClass('selected-circle');
                    $(e).parents('.selection').children('.boolean').text("1");
                } else {
                    $(e).html('').removeClass('selected-circle');
                    $(e).parents('.selection').children('.boolean').text("0");
                }
            };

            // 動態載入資料
            function loadReturnAccount(jsonDataIn) {
                // 如果有資料時
                if (jsonDataIn != null) {
                    // 如果有帳號紀錄時
                    if (typeof jsonDataIn[0].Account != "undefined") {
                        $('.container.return-step3  .selection:nth-child(4) .sub-title:nth-child(3) span').text(jsonDataIn[0].Bank);
                        $('.container.return-step3  .selection:nth-child(4) .sub-title:nth-child(4) span').text(jsonDataIn[0].Account);
                    }
                    // 無帳號紀錄時
                    else {

                    }
                }
                // 無資料時
                else {

                }
            };

            $('.container.return-step3 .submit').click(
                function() {
                    // 清空Cookie:退款方式
                    if (typeof Cookies.get("refundType") != "undefined") {
                        Cookies.remove("refundType");
                    }
                    let returnTypeArry = ["購物金", "匯款"];
                    let refundType;
                    let payName;
                    // 迴圈檢查選定的退款方式
                    $('.container.return-step3 .boolean').each(function(i, v) {
                        if ($(this).text() == "1") {
                            Cookies.set('refundType', returnTypeArry[i]);
                            refundType = returnTypeArry[i];
                            return null;
                        }
                    });
                    console.log(refundType);
                    // 如果沒選擇退款方式
                    if (typeof Cookies.get("refundType") === "undefined") {
                        $('#returnStepNotice .title').text('請選擇退款處理方式。');
                        $('#returnStepNotice').modal('show');
                    } else {
                        // 有選擇退款方式：匯款，但沒有填寫戶名
                        if (refundType == "匯款" && $('.container.return-step3 .selection:nth-child(4) .sub-title input').val().length == 0) {

                            $('#returnStepNotice .title').text('匯款必須提供戶名');
                            $('#returnStepNotice').modal('show');
                            return null;
                        } else {
                            // 有選擇退款方式：匯款，且戶名填寫完整時
                            payName = $('.container.return-step3 .selection:nth-child(4) .sub-title input').val();
                            console.log("payName" + payName);
                            // 送出更改退款戶名
                            // $.post('<c:url value="/user/order/updatePayName"/>', {
                            //     "orderID": location.search.substr(location.search.indexOf('=') + 1),
                            //     "payName": payName
                            // }, function(data) {

                            // });
                        };
                        // 將退款的Cookie設定每筆退款方式。
                        let arry = JSON.parse(Cookies.get("returnExchange"));
                        $.each(arry, function(i, v) {
                            v.refundType = refundType;
                        });
                        console.log(arry);
                        Cookies.set("returnExchange", arry);
                        location.href = "/memberOrderReturnStep4.html?orderID=" + location.search.substr(location.search.indexOf('=') + 1);
                    }
                }
            );
        </script>


        <!--半共用樣式區，Footer-->
        <footer class=" member-common-footer">
            <div class="member-order-return-step-common step1">
                <img src="images/return-animation-1.png" class="img-fluid" alt="" />
                <img src="images/dark-cloud.png" class="img-fluid" alt="" />
                <img src="images/rain-light.png" class="img-fluid" alt="" />
                <img src="images/rain-heavy.png" class="img-fluid" alt="" />
                <img src="images/rain-light.png" class="img-fluid" alt="" />
                <img src="images/rain-heavy.png" class="img-fluid" alt="" />
                <img src="images/rain-light.png" class="img-fluid" alt="" />
                <img src="images/rain-heavy.png" class="img-fluid" alt="" />
                <img src="images/member-myorder-footer-bg.png " class="img-fluid " alt=" " />
                <div class="icon-link ">
                    <a href=" " class=" ">
                        <img src="images/icon-fb.png " class="img-fluid " alt=" " />
                    </a>
                    <a href=" " class=" ">
                        <img src="images/icon-ig.png " class="img-fluid " alt=" " />
                    </a>
                    <a href=" " class=" ">
                        <img src="images/icon-utube.png " class="img-fluid " alt=" " />
                    </a>
                </div>
                <div class="footer-title ">
                    <div class="title ">會員訂單管理</div>
                    <div class="title ">退貨申請：商品處理方式</div>
                </div>
                <div class="footer-link ">
                    <a href="news.html " class="wonderfulType nav-link ">
                        <div class="title ">最新消息</div>
                        <div class="title ">News</div>
                    </a>
                    <a href="productIndex.html " class="wonderfulType nav-link ">
                        <div class="title ">商品專區</div>
                        <div class="title ">Products</div>
                    </a>
                    <a href=" " class="wonderfulType nav-link ">
                        <div class="title ">相片底家</div>
                        <div class="title ">Photos</div>
                    </a>
                    <a href="story.html " class="wonderfulType nav-link ">
                        <div class="title ">美好故事</div>
                        <div class="title ">About&nbsp;Us</div>
                    </a>
                    <a href=" " class="wonderfulType nav-link ">
                        <div class="title ">美好問答</div>
                        <div class="title ">Q&A</div>
                    </a>
                    <a href="contact.html " class="wonderfulType nav-link ">
                        <div class="title ">找尋美好</div>
                        <div class="title ">Find&nbsp;Us</div>
                    </a>
                </div>
            </div>
        </footer>
        <script>
            $('.member-order-return-step-common .footer-link .nav-link').hover(
                function() {
                    $(this).children('.title:last-child').css('opacity', "1 ");
                },
                function() {
                    $(this).children('.title:last-child').css('opacity', "0 ");
                }
            );
        </script>
    </div>
    <div class="ui modal" id="returnStepNotice">
        <div class="title"></div>
        <hr />
        <button type="none" class="submit">關閉</button>
    </div>
    <script>
        $('#returnStepNotice .submit').click(
            function() {
                $('#returnStepNotice').modal('hide');
            }
        );
    </script>
</body>

</html>